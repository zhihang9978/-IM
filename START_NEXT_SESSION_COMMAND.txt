═══════════════════════════════════════════════════════════════
  下次对话启动指令 - 复制粘贴即可无缝继续
═══════════════════════════════════════════════════════════════

任务：野火IM UI逻辑完整实现 - 阶段6-14

必读文档（严格按顺序）：
1. read_file: START_NEXT_SESSION_COMMAND.txt
2. read_file: WILDFIRE_UI_LOGIC_IMPLEMENTATION_PLAN.txt
3. read_file: NEXT_SESSION_EXECUTION_STEPS.txt
4. read_file: WILDFIRE_UI_RESOURCES_INVENTORY.txt
5. read_file: UI_EXTRACTION_PROGRESS.md
6. read_file: SESSION_WILDFIRE_UI_RESOURCES_COMPLETE.txt

确认当前状态：
- ✅ UI资源提取：100%完成（14/14阶段）
- ✅ 逻辑实现：36%完成（阶段1-5完整）
- ⏳ 待实现：阶段6-14逻辑功能
- Git状态：master分支，34 commits ahead of origin/master
- 工作区：clean（所有更改已提交）

⚠️ 野火IM参考路径（只读！仅作参考，不做任何修改）：
- 源码：android-chat-master/（⚠️ 只读参考）
- 布局：android-chat-master/uikit/src/main/res/layout/（⚠️ 只读参考）
- 图标：android-chat-master/uikit/src/main/res/mipmap-*/（⚠️ 只读参考）
- 代码：android-chat-master/uikit/src/main/java/cn/wildfire/chat/kit/（⚠️ 只读参考）

⚠️⚠️⚠️ 重要原则：android-chat-master文件夹只作为文件提取和逻辑参考，不做任何修复和修改！⚠️⚠️⚠️

蓝信目标路径：
- 源码：apps/android/
- 布局：apps/android/app/src/main/res/layout/
- 图标：apps/android/app/src/main/res/mipmap-*/
- 代码：apps/android/app/src/main/java/com/lanxin/im/

已提取的关键资源（防遗忘）：
✅ 15个布局文件（所有消息类型+聊天界面+列表）
✅ 42个图标文件（语音动画+视频+文件类型+输入面板+扩展功能+消息菜单）
✅ 11个Drawable/Shape（气泡、动画、背景、选择器）
✅ 2个工具类（FileTypeHelper、InputPanelState）
✅ 1个适配器（ConversationAdapter）

执行模式：
ENTER EXECUTE MODE

执行要求（严格遵守）：
✅ 完整复刻野火IM的所有逻辑功能
✅ 不简化任何步骤和功能
✅ 确保无BUG，功能正常可用
✅ 严格参考野火IM源代码实现
✅ 保留蓝信的业务逻辑和API调用
✅ 每个阶段独立Git提交
✅ 详细测试每个功能

执行顺序（按主计划WILDFIRE_UI_COMPLETE_REWRITE_MASTER_PLAN.txt）：

【第一优先级】核心功能逻辑（必须完成）：
1. ⚠️ 阶段7：输入面板完整逻辑（3-4小时）
   - 创建chat_input_panel_wildfire.xml完整布局
   - 实现语音/文本模式切换
   - 实现表情面板显示/隐藏
   - 实现扩展面板显示/隐藏
   - 实现键盘监听和自适应
   - 实现引用消息功能
   参考：ConversationInputPanel.java（约600行）

2. 阶段9：会话列表逻辑（2小时）
   - 更新ChatListFragment使用ConversationAdapter
   - 实现置顶会话背景区分
   - 实现草稿显示
   - 实现左滑删除（可选）
   参考：ConversationListAdapter.java

3. 阶段12：长按菜单逻辑（2小时）
   - 创建menu_message_context_wildfire.xml
   - 实现8项菜单功能：复制、转发、收藏、撤回、删除、引用、多选、举报
   - 实现撤回2分钟判断
   - 实现引用消息到输入框
   参考：ConversationFragment.java的菜单处理

【第二优先级】重要功能：
4. 阶段8：扩展面板逻辑（1小时）
   - 更新showMoreOptions()使用dialog_more_options_wildfire.xml
   - 绑定8个按钮点击事件

5. 阶段10：联系人列表逻辑（2小时）
   - 实现字母分组
   - 实现拼音排序
   - 实现快速索引条（可选）

6. 阶段11：用户信息页逻辑（2小时）
   - 创建fragment_user_info_wildfire.xml
   - 实现OptionItem绑定
   - 实现所有开关功能

【第三优先级】优化功能：
7. 阶段13：动画效果（2小时）
8. 阶段14：测试和优化（2-3小时）

关键参考代码位置（必读）：
1. android-chat-master/uikit/src/main/java/cn/wildfire/chat/kit/conversation/ConversationInputPanel.java
   ⚠️ 最重要！输入面板的核心逻辑（约600行）

2. android-chat-master/uikit/src/main/java/cn/wildfire/chat/kit/conversation/ConversationFragment.java
   消息列表、下拉刷新、未读提示、长按菜单

3. android-chat-master/uikit/src/main/java/cn/wildfire/chat/kit/conversationlist/ConversationListAdapter.java
   会话列表绑定、时间格式化、消息预览

4. android-chat-master/uikit/src/main/res/layout/conversation_input_panel.xml
   输入面板完整布局结构

技术难点提示：
⚠️ 键盘监听：使用ViewTreeObserver.OnGlobalLayoutListener
⚠️ 表情面板：可以先使用系统emoji键盘，后续集成第三方库
⚠️ 扩展面板高度：使用固定高度260dp或动态获取键盘高度
⚠️ 状态管理：使用InputPanelState枚举 + 显示/隐藏逻辑

每个阶段完成后必须：
□ 检查lints错误
□ 测试功能正常
□ Git提交
□ 更新UI_EXTRACTION_PROGRESS.md

完成标准：
✅ 所有消息类型正常发送/接收
✅ 输入面板状态切换流畅
✅ 会话列表显示完整
✅ 长按菜单8项全部可用
✅ 无编译错误
✅ 无运行时错误
✅ UI质量90分+

预计总工作量：18-20小时（建议分2次对话完成）

请立即进入EXECUTE MODE开始执行！

═══════════════════════════════════════════════════════════════

