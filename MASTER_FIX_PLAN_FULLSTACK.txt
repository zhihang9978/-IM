â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  å…¨æ ˆå®Œæ•´ä¿®å¤è®¡åˆ’ - ä¸¥æ ¼æ‰§è¡Œç‰ˆæœ¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

åˆ›å»ºæ—¶é—´: 2025-10-17
æ‰§è¡Œæ¨¡å¼: PLAN â†’ EXECUTE (ä¸¥æ ¼æ‰§è¡Œï¼Œä¸å…è®¸åç¦»)
ç›®æ ‡: å‰åç«¯é›†æˆä»56%æå‡åˆ°100%

âš ï¸ æœ¬è®¡åˆ’ä¸ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œå¿…é¡»ä¸¥æ ¼æ‰§è¡Œï¼Œä¸å…è®¸ä»»ä½•åç¦»ï¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š å½“å‰çŠ¶æ€è¯„ä¼°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å‰ç«¯çŠ¶æ€: 100%å®Œæˆ âœ…
- Androidä»£ç : 2450è¡Œ
- UIå®Œæ•´åº¦: 100%
- é€»è¾‘å®Œæ•´åº¦: 100%
- Linté”™è¯¯: 0ä¸ª

åç«¯çŠ¶æ€: 60%å®Œæˆ âš ï¸
- APIå®ç°: 16/25 (64%)
- æ•°æ®å®Œæ•´: 40%
- åŠŸèƒ½å¯ç”¨: 50%
- ç¼ºå°‘9ä¸ªå…³é”®API

é›†æˆçŠ¶æ€: 56%å®Œæˆ âŒ
- P0ç¼ºé™·: 3ä¸ªï¼ˆé˜»å¡ï¼‰
- P1ç¼ºé™·: 4ä¸ªï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
- P2ç¼ºé™·: 3ä¸ªï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
- P3ç¼ºé™·: 3ä¸ªï¼ˆä½ä¼˜å…ˆçº§ï¼‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ ä¿®å¤ç›®æ ‡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æœ€ç»ˆç›®æ ‡:
- å‰ç«¯: ä¿æŒ100% âœ…
- åç«¯: æå‡è‡³100% 
- é›†æˆ: æå‡è‡³100%
- å¯ç”¨åº¦: æå‡è‡³95%+
- æ‰€æœ‰ç¼ºé™·: 0ä¸ª

é¢„è®¡æ—¶é—´: 5å¤©ï¼ˆ40å°æ—¶ï¼‰
äº¤ä»˜æ ‡å‡†: ç”Ÿäº§çº§åˆ«ï¼Œå¯ç›´æ¥ä¸Šçº¿

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ é˜¶æ®µ1ï¼šP0çº§ç¼ºé™·ä¿®å¤ï¼ˆDay 1 - 8å°æ—¶ï¼‰â›” æœ€é«˜ä¼˜å…ˆçº§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç›®æ ‡: æ¶ˆé™¤3ä¸ªé˜»å¡æ€§ç¼ºé™·
æˆåŠŸæ ‡å‡†: æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨å¯ç”¨ï¼Œè¾¾åˆ°75%å¯ç”¨åº¦

ã€P0-1ã€‘å®ç°å†å²æ¶ˆæ¯API (2.5å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤1.1: åˆ›å»ºDAOå±‚æ–¹æ³•
æ–‡ä»¶: apps/backend/internal/dao/message_dao.go
ä½ç½®: åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ 
ä»£ç :
```go
// GetHistoryMessages è·å–å†å²æ¶ˆæ¯ï¼ˆåˆ†é¡µï¼Œä»æŒ‡å®šæ¶ˆæ¯IDä¹‹å‰ï¼‰
// å‚æ•°ï¼šconversationID - ä¼šè¯ID
//      beforeMessageID - è·å–æ­¤æ¶ˆæ¯IDä¹‹å‰çš„æ¶ˆæ¯ï¼ˆ0è¡¨ç¤ºæœ€æ–°ï¼‰
//      limit - è¿”å›æ¶ˆæ¯æ•°é‡é™åˆ¶
// è¿”å›ï¼šæ¶ˆæ¯åˆ—è¡¨ï¼ˆæŒ‰æ—¶é—´æ­£åºï¼‰
func (d *MessageDAO) GetHistoryMessages(conversationID, beforeMessageID uint, limit int) ([]model.Message, error) {
	var messages []model.Message
	
	query := d.db.Where("conversation_id = ?", conversationID)
	
	// å¦‚æœæŒ‡å®šäº†beforeMessageIDï¼Œåªè·å–IDæ›´å°çš„æ¶ˆæ¯ï¼ˆæ›´æ—©çš„æ¶ˆæ¯ï¼‰
	if beforeMessageID > 0 {
		query = query.Where("id < ?", beforeMessageID)
	}
	
	// æŒ‰IDå€’åºæŸ¥è¯¢ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰ï¼Œç„¶åé™åˆ¶æ•°é‡
	err := query.
		Order("id DESC").
		Limit(limit).
		Preload("Sender").
		Preload("Receiver").
		Find(&messages).Error
		
	if err != nil {
		return nil, err
	}
	
	// åè½¬æ•°ç»„ï¼Œä½¿æœ€æ—©çš„æ¶ˆæ¯åœ¨å‰é¢
	for i, j := 0, len(messages)-1; i < j; i, j = i+1, j-1 {
		messages[i], messages[j] = messages[j], messages[i]
	}
	
	return messages, nil
}
```

æ­¥éª¤1.2: åˆ›å»ºServiceå±‚æ–¹æ³•
æ–‡ä»¶: apps/backend/internal/service/message_service.go
ä½ç½®: åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ 
ä»£ç :
```go
// GetHistoryMessages è·å–å†å²æ¶ˆæ¯
func (s *MessageService) GetHistoryMessages(conversationID, beforeMessageID uint, limit int) ([]model.Message, error) {
	return s.messageDAO.GetHistoryMessages(conversationID, beforeMessageID, limit)
}
```

æ­¥éª¤1.3: åˆ›å»ºAPI Handler
æ–‡ä»¶: apps/backend/internal/api/message.go
ä½ç½®: åœ¨RecallMessageæ–¹æ³•ä¹‹åæ·»åŠ 
ä»£ç :
```go
// GetHistoryMessages è·å–å†å²æ¶ˆæ¯ï¼ˆåˆ†é¡µï¼‰
// GET /conversations/:id/messages/history?before_message_id=123&limit=20
func (h *MessageHandler) GetHistoryMessages(c *gin.Context) {
	conversationID, _ := strconv.ParseUint(c.Param("id"), 10, 32)
	beforeMessageID, _ := strconv.ParseUint(c.Query("before_message_id"), 10, 32)
	limit, _ := strconv.Atoi(c.DefaultQuery("limit", "20"))
	
	// é™åˆ¶æ¯æ¬¡æœ€å¤š100æ¡
	if limit > 100 {
		limit = 100
	}
	
	messages, err := h.messageService.GetHistoryMessages(
		uint(conversationID),
		uint(beforeMessageID),
		limit,
	)
	
	if err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{
			"code":    500,
			"message": err.Error(),
			"data":    nil,
		})
		return
	}
	
	c.JSON(http.StatusOK, gin.H{
		"code":    0,
		"message": "success",
		"data": gin.H{
			"total":    len(messages),
			"messages": messages,
		},
	})
}
```

æ­¥éª¤1.4: æ³¨å†Œè·¯ç”±
æ–‡ä»¶: apps/backend/cmd/server/main.go
ä½ç½®: line 130ä¹‹åï¼ˆåœ¨GetMessagesä¹‹åï¼‰
ä»£ç :
```go
authorized.GET("/conversations/:id/messages/history", messageHandler.GetHistoryMessages)
```

æ­¥éª¤1.5: æµ‹è¯•éªŒè¯
æ‰§è¡Œå‘½ä»¤:
```bash
# å¯åŠ¨åç«¯
cd apps/backend
go run cmd/server/main.go

# æµ‹è¯•APIï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
curl -X GET "http://localhost:8080/api/v1/conversations/1/messages/history?before_message_id=100&limit=20" \
  -H "Authorization: Bearer YOUR_TOKEN"

# æœŸæœ›è¿”å›:
# {"code":0,"message":"success","data":{"total":20,"messages":[...]}}
```

Androidæµ‹è¯•:
- æ‰“å¼€èŠå¤©é¡µé¢
- ä¸‹æ‹‰åˆ·æ–°
- åº”è¯¥åŠ è½½å†å²æ¶ˆæ¯

æˆåŠŸæ ‡å‡†:
âœ… APIè¿”å›200çŠ¶æ€ç 
âœ… è¿”å›å†å²æ¶ˆæ¯åˆ—è¡¨
âœ… æ¶ˆæ¯æŒ‰æ—¶é—´æ­£åºæ’åˆ—
âœ… Androidä¸‹æ‹‰åˆ·æ–°æˆåŠŸåŠ è½½

ã€P0-2ã€‘å®Œå–„ä¼šè¯åˆ—è¡¨æ•°æ® (3å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤2.1: ä¿®æ”¹ConversationDAOæ·»åŠ Preload
æ–‡ä»¶: apps/backend/internal/dao/conversation_dao.go
ä½ç½®: ä¿®æ”¹GetUserConversationsæ–¹æ³•
ä»£ç :
```go
// GetUserConversations è·å–ç”¨æˆ·çš„ä¼šè¯åˆ—è¡¨ï¼ˆå«å®Œæ•´å…³è”æ•°æ®ï¼‰
func (d *ConversationDAO) GetUserConversations(userID uint) ([]model.Conversation, error) {
	var conversations []model.Conversation
	
	err := d.db.
		Where("user1_id = ? OR user2_id = ?", userID, userID).
		Preload("User1").           // âœ… åŠ è½½User1ä¿¡æ¯
		Preload("User2").           // âœ… åŠ è½½User2ä¿¡æ¯
		Preload("LastMessage").     // âœ… åŠ è½½æœ€åä¸€æ¡æ¶ˆæ¯
		Preload("LastMessage.Sender"). // âœ… åŠ è½½æ¶ˆæ¯å‘é€è€…
		Order("updated_at DESC").
		Find(&conversations).Error
		
	return conversations, err
}
```

æ­¥éª¤2.2: æ·»åŠ æœªè¯»è®¡æ•°æ–¹æ³•
æ–‡ä»¶: apps/backend/internal/dao/conversation_dao.go
ä½ç½®: åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ 
ä»£ç :
```go
// GetUnreadCount è·å–ä¼šè¯çš„æœªè¯»æ¶ˆæ¯æ•°é‡
// å‚æ•°ï¼šconversationID - ä¼šè¯ID
//      userID - å½“å‰ç”¨æˆ·IDï¼ˆä½œä¸ºæ¥æ”¶è€…ï¼‰
// è¿”å›ï¼šæœªè¯»æ¶ˆæ¯æ•°é‡
func (d *ConversationDAO) GetUnreadCount(conversationID, userID uint) int {
	var count int64
	
	// ç»Ÿè®¡è¯¥ä¼šè¯ä¸­ï¼Œæ¥æ”¶è€…æ˜¯å½“å‰ç”¨æˆ·ä¸”çŠ¶æ€ä¸æ˜¯å·²è¯»çš„æ¶ˆæ¯
	d.db.Model(&model.Message{}).
		Where("conversation_id = ? AND receiver_id = ? AND status != ?", 
			conversationID, userID, model.MessageStatusRead).
		Count(&count)
		
	return int(count)
}
```

æ­¥éª¤2.3: ä¿®æ”¹API Handlerè¿”å›å®Œæ•´æ•°æ®
æ–‡ä»¶: apps/backend/internal/api/conversation.go
ä½ç½®: ä¿®æ”¹GetConversationsæ–¹æ³•
ä»£ç :
```go
// GetConversations è·å–ç”¨æˆ·çš„ä¼šè¯åˆ—è¡¨ï¼ˆå«å®Œæ•´æ•°æ®ï¼‰
func (h *ConversationHandler) GetConversations(c *gin.Context) {
	userID, _ := middleware.GetUserID(c)

	conversations, err := h.conversationDAO.GetUserConversations(userID)
	if err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{
			"code":    500,
			"message": err.Error(),
			"data":    nil,
		})
		return
	}

	// è½¬æ¢ä¸ºå“åº”æ ¼å¼ï¼ˆåŒ…å«å®Œæ•´æ•°æ®ï¼‰
	items := make([]map[string]interface{}, len(conversations))
	for i, conv := range conversations {
		// âœ… è®¡ç®—çœŸå®æœªè¯»æ•°
		unreadCount := h.conversationDAO.GetUnreadCount(conv.ID, userID)
		
		item := map[string]interface{}{
			"id":            conv.ID,
			"type":          conv.Type,
			"unread_count":  unreadCount,          // âœ… çœŸå®è®¡ç®—
			"updated_at":    conv.UpdatedAt.Unix(),
			"last_message":  conv.LastMessage,     // âœ… åŒ…å«æœ€åæ¶ˆæ¯
		}
		
		// âœ… æ·»åŠ å¯¹æ–¹ç”¨æˆ·ä¿¡æ¯ï¼ˆå•èŠï¼‰
		if conv.Type == "single" {
			if conv.User1ID != nil && *conv.User1ID != userID {
				item["user"] = conv.User1
			} else if conv.User2ID != nil {
				item["user"] = conv.User2
			}
		} else if conv.Type == "group" && conv.Group != nil {
			// ç¾¤èŠä¿¡æ¯
			item["group"] = conv.Group
		}
		
		items[i] = item
	}

	c.JSON(http.StatusOK, gin.H{
		"code":    0,
		"message": "success",
		"data": gin.H{
			"conversations": items,
		},
	})
}
```

æ­¥éª¤2.4: æµ‹è¯•éªŒè¯
æ‰§è¡Œå‘½ä»¤:
```bash
# æµ‹è¯•API
curl -X GET "http://localhost:8080/api/v1/conversations" \
  -H "Authorization: Bearer YOUR_TOKEN"

# æœŸæœ›è¿”å›:
# {
#   "code": 0,
#   "data": {
#     "conversations": [
#       {
#         "id": 1,
#         "type": "single",
#         "user": {...},
#         "last_message": {...},  // âœ… æœ‰å†…å®¹
#         "unread_count": 5       // âœ… çœŸå®æ•°å­—
#       }
#     ]
#   }
# }
```

Androidæµ‹è¯•:
- æ‰“å¼€ä¼šè¯åˆ—è¡¨
- åº”æ˜¾ç¤ºæœ€åæ¶ˆæ¯å†…å®¹
- åº”æ˜¾ç¤ºçœŸå®æœªè¯»æ•°

æˆåŠŸæ ‡å‡†:
âœ… è¿”å›last_messageå­—æ®µ
âœ… unread_countä¸ºçœŸå®å€¼
âœ… Androidæ˜¾ç¤ºæ¶ˆæ¯é¢„è§ˆ
âœ… Androidæ˜¾ç¤ºæœªè¯»å¾½ç« 

ã€P0-3ã€‘å‰ç«¯ç±»å‹å®‰å…¨ä¿®å¤ (0.5å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

å·²å®Œæˆ âœ…
- ContactItem.useræ”¹ä¸ºå¯ç©º
- ContactsFragmentæ·»åŠ nullæ£€æŸ¥
- æ·»åŠ user_idå­—æ®µ

ã€P0é˜¶æ®µæµ‹è¯•ã€‘(2å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æµ‹è¯•æ¸…å•:
1. [ ] æµ‹è¯•å†å²æ¶ˆæ¯åŠ è½½ï¼ˆå¤šæ¬¡ä¸‹æ‹‰ï¼‰
2. [ ] æµ‹è¯•ä¼šè¯åˆ—è¡¨æ˜¾ç¤º
3. [ ] æµ‹è¯•æœªè¯»æ•°æ˜¾ç¤º
4. [ ] æµ‹è¯•æ¶ˆæ¯é¢„è§ˆæ˜¾ç¤º
5. [ ] æµ‹è¯•è”ç³»äººåˆ—è¡¨ä¸å´©æºƒ
6. [ ] ç«¯åˆ°ç«¯æ¶ˆæ¯æ”¶å‘æµ‹è¯•
7. [ ] æ€§èƒ½æµ‹è¯•ï¼ˆ1000æ¡æ¶ˆæ¯ï¼‰
8. [ ] è¾¹ç•Œæµ‹è¯•ï¼ˆç©ºæ•°æ®ã€ç½‘ç»œé”™è¯¯ï¼‰

P0é˜¶æ®µäº¤ä»˜ç‰©:
âœ… å†å²æ¶ˆæ¯APIå®Œæ•´å®ç°
âœ… ä¼šè¯åˆ—è¡¨æ•°æ®å®Œæ•´
âœ… å‰ç«¯ç±»å‹å®‰å…¨
âœ… æµ‹è¯•é€šè¿‡æŠ¥å‘Š

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ é˜¶æ®µ2ï¼šP1çº§ç¼ºé™·ä¿®å¤ï¼ˆDay 2 - 8å°æ—¶ï¼‰âš ï¸ é«˜ä¼˜å…ˆçº§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç›®æ ‡: å®ç°è”ç³»äººç®¡ç†å’Œå…¶ä»–é«˜é¢‘åŠŸèƒ½
æˆåŠŸæ ‡å‡†: è¾¾åˆ°90%å¯ç”¨åº¦

ã€P1-1ã€‘å®ç°è”ç³»äººç®¡ç†API (3å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤3.1: æ·»åŠ DAOå±‚æ–¹æ³•
æ–‡ä»¶: apps/backend/internal/dao/contact_dao.go
ä½ç½®: åœ¨Createæ–¹æ³•ä¹‹åæ·»åŠ 
ä»£ç :
```go
// Delete åˆ é™¤è”ç³»äººï¼ˆé€»è¾‘åˆ é™¤æˆ–ç‰©ç†åˆ é™¤ï¼‰
func (d *ContactDAO) Delete(contactID, userID uint) error {
	// éªŒè¯æƒé™ï¼šåªèƒ½åˆ é™¤è‡ªå·±çš„è”ç³»äºº
	return d.db.Where("id = ? AND user_id = ?", contactID, userID).
		Delete(&model.Contact{}).Error
}

// UpdateRemark æ›´æ–°è”ç³»äººå¤‡æ³¨å’Œæ ‡ç­¾
func (d *ContactDAO) UpdateRemark(contactID, userID uint, remark, tags string) error {
	// éªŒè¯æƒé™ï¼šåªèƒ½ä¿®æ”¹è‡ªå·±çš„è”ç³»äºº
	return d.db.Model(&model.Contact{}).
		Where("id = ? AND user_id = ?", contactID, userID).
		Updates(map[string]interface{}{
			"remark": remark,
			"tags":   tags,
		}).Error
}

// GetByID æ ¹æ®IDè·å–è”ç³»äººï¼ˆå«æƒé™éªŒè¯ï¼‰
func (d *ContactDAO) GetByID(contactID, userID uint) (*model.Contact, error) {
	var contact model.Contact
	err := d.db.Where("id = ? AND user_id = ?", contactID, userID).
		Preload("ContactUser").
		First(&contact).Error
	return &contact, err
}

// CheckExists æ£€æŸ¥è”ç³»äººæ˜¯å¦å·²å­˜åœ¨
func (d *ContactDAO) CheckExists(userID, contactID uint) bool {
	var count int64
	d.db.Model(&model.Contact{}).
		Where("user_id = ? AND contact_id = ?", userID, contactID).
		Count(&count)
	return count > 0
}
```

æ­¥éª¤3.2: æ·»åŠ API Handler
æ–‡ä»¶: apps/backend/internal/api/contact.go
ä½ç½®: åœ¨GetContactsæ–¹æ³•ä¹‹åæ·»åŠ 
ä»£ç :
```go
// AddContact æ·»åŠ è”ç³»äºº
// POST /contacts
// Body: {"contact_id": 123, "remark": "å¼ ä¸‰", "tags": "æœ‹å‹,åŒäº‹"}
func (h *ContactHandler) AddContact(c *gin.Context) {
	userID, _ := middleware.GetUserID(c)
	
	var req struct {
		ContactID uint   `json:"contact_id" binding:"required"`
		Remark    string `json:"remark"`
		Tags      string `json:"tags"`
	}
	
	if err := c.ShouldBindJSON(&req); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{
			"code":    400,
			"message": "Invalid request parameters",
			"data":    nil,
		})
		return
	}
	
	// éªŒè¯ï¼šä¸èƒ½æ·»åŠ è‡ªå·±ä¸ºè”ç³»äºº
	if req.ContactID == userID {
		c.JSON(http.StatusBadRequest, gin.H{
			"code":    400,
			"message": "Cannot add yourself as contact",
			"data":    nil,
		})
		return
	}
	
	// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
	if h.contactDAO.CheckExists(userID, req.ContactID) {
		c.JSON(http.StatusBadRequest, gin.H{
			"code":    400,
			"message": "Contact already exists",
			"data":    nil,
		})
		return
	}
	
	// åˆ›å»ºè”ç³»äºº
	contact := &model.Contact{
		UserID:    userID,
		ContactID: req.ContactID,
		Remark:    req.Remark,
		Tags:      req.Tags,
		Status:    model.ContactStatusNormal,
	}
	
	if err := h.contactDAO.Create(contact); err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{
			"code":    500,
			"message": "Failed to add contact",
			"data":    nil,
		})
		return
	}
	
	// é‡æ–°åŠ è½½ä»¥è·å–å…³è”æ•°æ®
	contact, _ = h.contactDAO.GetByID(contact.ID, userID)
	
	c.JSON(http.StatusOK, gin.H{
		"code":    0,
		"message": "Contact added successfully",
		"data": gin.H{
			"contact": contact,
		},
	})
}

// DeleteContact åˆ é™¤è”ç³»äºº
// DELETE /contacts/:id
func (h *ContactHandler) DeleteContact(c *gin.Context) {
	userID, _ := middleware.GetUserID(c)
	contactID, _ := strconv.ParseUint(c.Param("id"), 10, 32)
	
	// éªŒè¯è”ç³»äººæ˜¯å¦å­˜åœ¨ä¸”å±äºå½“å‰ç”¨æˆ·
	_, err := h.contactDAO.GetByID(uint(contactID), userID)
	if err != nil {
		c.JSON(http.StatusNotFound, gin.H{
			"code":    404,
			"message": "Contact not found",
			"data":    nil,
		})
		return
	}
	
	// åˆ é™¤
	if err := h.contactDAO.Delete(uint(contactID), userID); err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{
			"code":    500,
			"message": "Failed to delete contact",
			"data":    nil,
		})
		return
	}
	
	c.JSON(http.StatusOK, gin.H{
		"code":    0,
		"message": "Contact deleted successfully",
		"data":    nil,
	})
}

// UpdateRemark æ›´æ–°è”ç³»äººå¤‡æ³¨å’Œæ ‡ç­¾
// PUT /contacts/:id/remark
// Body: {"remark": "å¼ ä¸‰", "tags": "æœ‹å‹,åŒäº‹"}
func (h *ContactHandler) UpdateRemark(c *gin.Context) {
	userID, _ := middleware.GetUserID(c)
	contactID, _ := strconv.ParseUint(c.Param("id"), 10, 32)
	
	var req struct {
		Remark string `json:"remark"`
		Tags   string `json:"tags"`
	}
	
	if err := c.ShouldBindJSON(&req); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{
			"code":    400,
			"message": "Invalid request parameters",
			"data":    nil,
		})
		return
	}
	
	// éªŒè¯è”ç³»äººæ˜¯å¦å­˜åœ¨
	_, err := h.contactDAO.GetByID(uint(contactID), userID)
	if err != nil {
		c.JSON(http.StatusNotFound, gin.H{
			"code":    404,
			"message": "Contact not found",
			"data":    nil,
		})
		return
	}
	
	// æ›´æ–°
	if err := h.contactDAO.UpdateRemark(uint(contactID), userID, req.Remark, req.Tags); err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{
			"code":    500,
			"message": "Failed to update remark",
			"data":    nil,
		})
		return
	}
	
	c.JSON(http.StatusOK, gin.H{
		"code":    0,
		"message": "Remark updated successfully",
		"data":    nil,
	})
}
```

æ­¥éª¤3.3: æ³¨å†Œè·¯ç”±
æ–‡ä»¶: apps/backend/cmd/server/main.go
ä½ç½®: line 124ä¹‹åï¼ˆåœ¨GET /contactsä¹‹åï¼‰
ä»£ç :
```go
authorized.POST("/contacts", contactHandler.AddContact)
authorized.DELETE("/contacts/:id", contactHandler.DeleteContact)
authorized.PUT("/contacts/:id/remark", contactHandler.UpdateRemark)
```

æ­¥éª¤3.4: æ›´æ–°å‰ç«¯RemarkActivity APIè°ƒç”¨
æ–‡ä»¶: apps/android/app/src/main/java/com/lanxin/im/ui/profile/RemarkActivity.kt
ä½ç½®: saveRemarkæ–¹æ³•
ä¿®æ”¹:
```kotlin
private fun saveRemark() {
    val remark = etRemark.text.toString().trim()
    val tags = etTags.text.toString().trim()
    
    lifecycleScope.launch {
        try {
            // âœ… è°ƒç”¨çœŸå®API
            val response = RetrofitClient.apiService.updateContactRemark(
                contactId,
                mapOf("remark" to remark, "tags" to tags)
            )
            
            if (response.code == 0) {
                Toast.makeText(this@RemarkActivity, "å¤‡æ³¨å·²ä¿å­˜", Toast.LENGTH_SHORT).show()
                setResult(RESULT_OK)
                finish()
            } else {
                Toast.makeText(this@RemarkActivity, response.message, Toast.LENGTH_SHORT).show()
            }
        } catch (e: Exception) {
            Toast.makeText(this@RemarkActivity, "ä¿å­˜å¤±è´¥: ${e.message}", Toast.LENGTH_SHORT).show()
        }
    }
}
```

æ­¥éª¤3.5: æ·»åŠ å‰ç«¯APIå®šä¹‰
æ–‡ä»¶: apps/android/app/src/main/java/com/lanxin/im/data/remote/ApiService.kt
ä½ç½®: DELETE /contacts/{id}ä¹‹åæ·»åŠ 
ä»£ç :
```kotlin
@PUT("contacts/{id}/remark")
suspend fun updateContactRemark(
    @Path("id") id: Long,
    @Body request: Map<String, String>
): ApiResponse<Any?>
```

æ­¥éª¤3.6: æµ‹è¯•éªŒè¯
æµ‹è¯•:
1. [ ] æ·»åŠ è”ç³»äºº
2. [ ] åˆ é™¤è”ç³»äºº
3. [ ] è®¾ç½®å¤‡æ³¨å’Œæ ‡ç­¾
4. [ ] éªŒè¯æƒé™æ§åˆ¶
5. [ ] éªŒè¯é‡å¤æ·»åŠ æ£€æµ‹

ã€P1-2ã€‘å®ç°å¯†ç ä¿®æ”¹API (1.5å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤4.1: æ·»åŠ DAOå±‚æ–¹æ³•
æ–‡ä»¶: apps/backend/internal/dao/user_dao.go
ä½ç½®: åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ 
ä»£ç :
```go
// UpdatePassword æ›´æ–°ç”¨æˆ·å¯†ç 
func (d *UserDAO) UpdatePassword(userID uint, hashedPassword string) error {
	return d.db.Model(&model.User{}).
		Where("id = ?", userID).
		Update("password", hashedPassword).Error
}

// GetByID æ ¹æ®IDè·å–ç”¨æˆ·
func (d *UserDAO) GetByID(userID uint) (*model.User, error) {
	var user model.User
	err := d.db.Where("id = ?", userID).First(&user).Error
	return &user, err
}
```

æ­¥éª¤4.2: æ·»åŠ å¯†ç å“ˆå¸Œå·¥å…·
æ–‡ä»¶: apps/backend/internal/api/user.go
ä½ç½®: åœ¨æ–‡ä»¶é¡¶éƒ¨importä¹‹åæ·»åŠ è¾…åŠ©å‡½æ•°
ä»£ç :
```go
import (
	"golang.org/x/crypto/bcrypt"
)

// hashPassword ç”Ÿæˆå¯†ç å“ˆå¸Œ
func hashPassword(password string) (string, error) {
	bytes, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)
	return string(bytes), err
}

// checkPasswordHash éªŒè¯å¯†ç 
func checkPasswordHash(password, hash string) bool {
	err := bcrypt.CompareHashAndPassword([]byte(hash), []byte(password))
	return err == nil
}
```

æ­¥éª¤4.3: æ·»åŠ API Handler
æ–‡ä»¶: apps/backend/internal/api/user.go
ä½ç½®: åœ¨UpdateProfileæ–¹æ³•ä¹‹åæ·»åŠ 
ä»£ç :
```go
// ChangePassword ä¿®æ”¹å¯†ç 
// PUT /users/me/password
// Body: {"old_password": "old123", "new_password": "new123"}
func (h *UserHandler) ChangePassword(c *gin.Context) {
	userID, _ := middleware.GetUserID(c)
	
	var req struct {
		OldPassword string `json:"old_password" binding:"required,min=6"`
		NewPassword string `json:"new_password" binding:"required,min=6"`
	}
	
	if err := c.ShouldBindJSON(&req); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{
			"code":    400,
			"message": "Invalid request parameters",
			"data":    nil,
		})
		return
	}
	
	// è·å–å½“å‰ç”¨æˆ·
	user, err := h.userDAO.GetByID(userID)
	if err != nil {
		c.JSON(http.StatusNotFound, gin.H{
			"code":    404,
			"message": "User not found",
			"data":    nil,
		})
		return
	}
	
	// éªŒè¯æ—§å¯†ç 
	if !checkPasswordHash(req.OldPassword, user.Password) {
		c.JSON(http.StatusUnauthorized, gin.H{
			"code":    401,
			"message": "Old password is incorrect",
			"data":    nil,
		})
		return
	}
	
	// éªŒè¯æ–°æ—§å¯†ç ä¸åŒ
	if req.OldPassword == req.NewPassword {
		c.JSON(http.StatusBadRequest, gin.H{
			"code":    400,
			"message": "New password must be different from old password",
			"data":    nil,
		})
		return
	}
	
	// ç”Ÿæˆæ–°å¯†ç å“ˆå¸Œ
	hashedPassword, err := hashPassword(req.NewPassword)
	if err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{
			"code":    500,
			"message": "Failed to hash password",
			"data":    nil,
		})
		return
	}
	
	// æ›´æ–°å¯†ç 
	if err := h.userDAO.UpdatePassword(userID, hashedPassword); err != nil {
		c.JSON(http.StatusInternalServerError, gin.H{
			"code":    500,
			"message": "Failed to update password",
			"data":    nil,
		})
		return
	}
	
	c.JSON(http.StatusOK, gin.H{
		"code":    0,
		"message": "Password changed successfully",
		"data":    nil,
	})
}
```

æ­¥éª¤4.4: æ³¨å†Œè·¯ç”±
æ–‡ä»¶: apps/backend/cmd/server/main.go
ä½ç½®: line 117ä¹‹å
ä»£ç :
```go
authorized.PUT("/users/me/password", userHandler.ChangePassword)
```

æ­¥éª¤4.5: æ·»åŠ ä¾èµ–
æ–‡ä»¶: apps/backend/go.mod
ç¡®è®¤å­˜åœ¨:
```go
require (
	golang.org/x/crypto v0.x.x
)
```

å¦‚ä¸å­˜åœ¨ï¼Œæ‰§è¡Œ:
```bash
cd apps/backend
go get golang.org/x/crypto/bcrypt
go mod tidy
```

ã€P1-3ã€‘å®Œå–„WebSocketæ¶ˆæ¯å¤„ç† (2å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤5.1: åˆ›å»ºWebSocketæ¶ˆæ¯ç±»å‹å®šä¹‰
æ–‡ä»¶: apps/android/app/src/main/java/com/lanxin/im/data/remote/WebSocketMessage.kt
ä½ç½®: æ–°å»ºæ–‡ä»¶
ä»£ç :
```kotlin
package com.lanxin.im.data.remote

import com.google.gson.annotations.SerializedName

/**
 * WebSocketæ¶ˆæ¯ç±»å‹å®šä¹‰
 */
data class WebSocketMessage(
    val type: String,  // new_message, message_read, message_recalled, user_online, user_offline
    val data: Any?
)

data class WSNewMessage(
    val message: com.lanxin.im.data.model.Message
)

data class WSMessageRead(
    @SerializedName("message_id")
    val messageId: Long,
    @SerializedName("conversation_id")
    val conversationId: Long
)

data class WSMessageRecalled(
    @SerializedName("message_id")
    val messageId: Long,
    @SerializedName("conversation_id")
    val conversationId: Long
)

data class WSUserStatus(
    @SerializedName("user_id")
    val userId: Long,
    val status: String  // online, offline
)
```

æ­¥éª¤5.2: æ›´æ–°WebSocketClientå¤„ç†é€»è¾‘
æ–‡ä»¶: apps/android/app/src/main/java/com/lanxin/im/data/remote/WebSocketClient.kt
ä½ç½®: ä¿®æ”¹onMessageæ–¹æ³•
ä»£ç :
```kotlin
override fun onMessage(webSocket: WebSocket, text: String) {
    Log.d(TAG, "WebSocket message received: $text")
    
    try {
        val gson = Gson()
        val wsMessage = gson.fromJson(text, WebSocketMessage::class.java)
        
        when (wsMessage.type) {
            "new_message" -> {
                // æ–°æ¶ˆæ¯åˆ°è¾¾
                val data = gson.fromJson(gson.toJson(wsMessage.data), WSNewMessage::class.java)
                handleNewMessage(data.message)
            }
            "message_read" -> {
                // æ¶ˆæ¯å·²è¯»å›æ‰§
                val data = gson.fromJson(gson.toJson(wsMessage.data), WSMessageRead::class.java)
                handleMessageRead(data.messageId, data.conversationId)
            }
            "message_recalled" -> {
                // æ¶ˆæ¯æ’¤å›é€šçŸ¥
                val data = gson.fromJson(gson.toJson(wsMessage.data), WSMessageRecalled::class.java)
                handleMessageRecalled(data.messageId, data.conversationId)
            }
            "user_online", "user_offline" -> {
                // ç”¨æˆ·åœ¨çº¿çŠ¶æ€å˜åŒ–
                val data = gson.fromJson(gson.toJson(wsMessage.data), WSUserStatus::class.java)
                handleUserStatus(data.userId, data.status)
            }
        }
    } catch (e: Exception) {
        Log.e(TAG, "Failed to parse WebSocket message", e)
    }
}

private fun handleNewMessage(message: Message) {
    // å‘é€æœ¬åœ°å¹¿æ’­ï¼Œé€šçŸ¥UIæ›´æ–°
    val intent = Intent("com.lanxin.im.NEW_MESSAGE")
    intent.putExtra("message", message)
    intent.putExtra("conversation_id", message.conversationId)
    context.sendBroadcast(intent)
    
    // æ›´æ–°æœ¬åœ°æ•°æ®åº“
    lifecycleScope.launch {
        // TODO: æ’å…¥æœ¬åœ°æ•°æ®åº“
    }
}

private fun handleMessageRead(messageId: Long, conversationId: Long) {
    val intent = Intent("com.lanxin.im.MESSAGE_READ")
    intent.putExtra("message_id", messageId)
    intent.putExtra("conversation_id", conversationId)
    context.sendBroadcast(intent)
}

private fun handleMessageRecalled(messageId: Long, conversationId: Long) {
    val intent = Intent("com.lanxin.im.MESSAGE_RECALLED")
    intent.putExtra("message_id", messageId)
    intent.putExtra("conversation_id", conversationId)
    context.sendBroadcast(intent)
}

private fun handleUserStatus(userId: Long, status: String) {
    val intent = Intent("com.lanxin.im.USER_STATUS")
    intent.putExtra("user_id", userId)
    intent.putExtra("status", status)
    context.sendBroadcast(intent)
}
```

æ­¥éª¤5.3: ChatActivityæ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨
æ–‡ä»¶: apps/android/app/src/main/java/com/lanxin/im/ui/chat/ChatActivity.kt
ä½ç½®: åœ¨onCreateä¸­æ·»åŠ 
ä»£ç :
```kotlin
private lateinit var messageReceiver: BroadcastReceiver

override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    // ... existing code ...
    
    // æ³¨å†Œæ¶ˆæ¯å¹¿æ’­æ¥æ”¶å™¨
    registerMessageReceiver()
}

private fun registerMessageReceiver() {
    messageReceiver = object : BroadcastReceiver() {
        override fun onReceive(context: Context?, intent: Intent?) {
            when (intent?.action) {
                "com.lanxin.im.NEW_MESSAGE" -> {
                    val message = intent.getParcelableExtra<Message>("message")
                    val convId = intent.getLongExtra("conversation_id", 0)
                    
                    // å¦‚æœæ˜¯å½“å‰ä¼šè¯çš„æ¶ˆæ¯ï¼Œæ·»åŠ åˆ°åˆ—è¡¨
                    if (convId == conversationId && message != null) {
                        val currentList = adapter.currentList.toMutableList()
                        currentList.add(message)
                        adapter.submitList(currentList)
                        recyclerView.scrollToPosition(currentList.size - 1)
                    }
                }
                "com.lanxin.im.MESSAGE_READ" -> {
                    // æ›´æ–°æ¶ˆæ¯çŠ¶æ€ä¸ºå·²è¯»
                    loadMessages()
                }
                "com.lanxin.im.MESSAGE_RECALLED" -> {
                    // åˆ·æ–°æ¶ˆæ¯åˆ—è¡¨
                    loadMessages()
                }
            }
        }
    }
    
    val filter = IntentFilter().apply {
        addAction("com.lanxin.im.NEW_MESSAGE")
        addAction("com.lanxin.im.MESSAGE_READ")
        addAction("com.lanxin.im.MESSAGE_RECALLED")
    }
    registerReceiver(messageReceiver, filter)
}

override fun onDestroy() {
    super.onDestroy()
    unregisterReceiver(messageReceiver)
}
```

æ­¥éª¤5.4: ChatListFragmentæ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨
æ–‡ä»¶: apps/android/app/src/main/java/com/lanxin/im/ui/chat/ChatListFragment.kt
ä½ç½®: åœ¨onViewCreatedä¸­æ·»åŠ 
ä»£ç :
```kotlin
private lateinit var messageReceiver: BroadcastReceiver

override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
    super.onViewCreated(view, savedInstanceState)
    setupRecyclerView()
    loadConversations()
    registerMessageReceiver()
}

private fun registerMessageReceiver() {
    messageReceiver = object : BroadcastReceiver() {
        override fun onReceive(context: Context?, intent: Intent?) {
            if (intent?.action == "com.lanxin.im.NEW_MESSAGE") {
                // åˆ·æ–°ä¼šè¯åˆ—è¡¨
                loadConversations()
            }
        }
    }
    
    val filter = IntentFilter("com.lanxin.im.NEW_MESSAGE")
    requireContext().registerReceiver(messageReceiver, filter)
}

override fun onDestroyView() {
    super.onDestroyView()
    requireContext().unregisterReceiver(messageReceiver)
}
```

ã€P1é˜¶æ®µæµ‹è¯•ã€‘(1.5å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æµ‹è¯•æ¸…å•:
1. [ ] æµ‹è¯•æ·»åŠ è”ç³»äººï¼ˆæˆåŠŸ/é‡å¤/è‡ªå·±ï¼‰
2. [ ] æµ‹è¯•åˆ é™¤è”ç³»äººï¼ˆæˆåŠŸ/ä¸å­˜åœ¨ï¼‰
3. [ ] æµ‹è¯•è®¾ç½®å¤‡æ³¨å’Œæ ‡ç­¾
4. [ ] æµ‹è¯•ä¿®æ”¹å¯†ç ï¼ˆæˆåŠŸ/æ—§å¯†ç é”™è¯¯/ç›¸åŒå¯†ç ï¼‰
5. [ ] æµ‹è¯•WebSocketå®æ—¶æ¶ˆæ¯æ¥æ”¶
6. [ ] æµ‹è¯•ä¼šè¯åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°
7. [ ] æµ‹è¯•æ¶ˆæ¯å·²è¯»çŠ¶æ€æ›´æ–°
8. [ ] æµ‹è¯•æ¶ˆæ¯æ’¤å›é€šçŸ¥

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ é˜¶æ®µ3ï¼šP2çº§åŠŸèƒ½è¡¥å……ï¼ˆDay 3-4 - 16å°æ—¶ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€P2-1ã€‘å®ç°æ”¶è—æ¶ˆæ¯åŠŸèƒ½ (2å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤6.1: åˆ›å»ºæ•°æ®åº“è¿ç§»
æ–‡ä»¶: apps/backend/migrations/008_create_favorites_table.up.sql
ä»£ç :
```sql
CREATE TABLE IF NOT EXISTS favorites (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    message_id BIGINT UNSIGNED NOT NULL,
    content TEXT NOT NULL,
    type VARCHAR(20) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

æ­¥éª¤6.2: åˆ›å»ºFavoriteæ¨¡å‹
æ–‡ä»¶: apps/backend/internal/model/favorite.go
ä»£ç :
```go
package model

import "time"

type Favorite struct {
	ID        uint      `gorm:"primarykey" json:"id"`
	UserID    uint      `gorm:"not null;index" json:"user_id"`
	MessageID uint      `gorm:"not null;index" json:"message_id"`
	Content   string    `gorm:"type:text;not null" json:"content"`
	Type      string    `gorm:"size:20;not null" json:"type"`
	CreatedAt time.Time `json:"created_at"`
	UpdatedAt time.Time `json:"updated_at"`
	
	// å…³è”
	User    User    `gorm:"foreignKey:UserID" json:"user,omitempty"`
	Message Message `gorm:"foreignKey:MessageID" json:"message,omitempty"`
}

func (Favorite) TableName() string {
	return "favorites"
}
```

æ­¥éª¤6.3: åˆ›å»ºFavoriteDAO
æ–‡ä»¶: apps/backend/internal/dao/favorite_dao.go
ä»£ç :
```go
package dao

import (
	"github.com/lanxin/im-backend/internal/model"
	"github.com/lanxin/im-backend/internal/pkg/mysql"
	"gorm.io/gorm"
)

type FavoriteDAO struct {
	db *gorm.DB
}

func NewFavoriteDAO() *FavoriteDAO {
	return &FavoriteDAO{
		db: mysql.GetDB(),
	}
}

// Create æ·»åŠ æ”¶è—
func (d *FavoriteDAO) Create(favorite *model.Favorite) error {
	return d.db.Create(favorite).Error
}

// GetUserFavorites è·å–ç”¨æˆ·çš„æ”¶è—åˆ—è¡¨
func (d *FavoriteDAO) GetUserFavorites(userID uint, page, pageSize int) ([]model.Favorite, int64, error) {
	var favorites []model.Favorite
	var total int64
	
	offset := (page - 1) * pageSize
	
	d.db.Model(&model.Favorite{}).Where("user_id = ?", userID).Count(&total)
	
	err := d.db.Where("user_id = ?", userID).
		Preload("Message").
		Order("created_at DESC").
		Offset(offset).
		Limit(pageSize).
		Find(&favorites).Error
		
	return favorites, total, err
}

// Delete åˆ é™¤æ”¶è—
func (d *FavoriteDAO) Delete(favoriteID, userID uint) error {
	return d.db.Where("id = ? AND user_id = ?", favoriteID, userID).
		Delete(&model.Favorite{}).Error
}

// CheckExists æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
func (d *FavoriteDAO) CheckExists(userID, messageID uint) bool {
	var count int64
	d.db.Model(&model.Favorite{}).
		Where("user_id = ? AND message_id = ?", userID, messageID).
		Count(&count)
	return count > 0
}
```

æ­¥éª¤6.4: åˆ›å»ºAPI Handler
æ–‡ä»¶: apps/backend/internal/api/favorite.go
ä»£ç : (å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬CollectMessage, GetFavorites, DeleteFavorite)

æ­¥éª¤6.5: æ³¨å†Œè·¯ç”±
æ–‡ä»¶: apps/backend/cmd/server/main.go
ä»£ç :
```go
favoriteHandler := api.NewFavoriteHandler()
authorized.POST("/messages/collect", favoriteHandler.CollectMessage)
authorized.GET("/favorites", favoriteHandler.GetFavorites)
authorized.DELETE("/favorites/:id", favoriteHandler.DeleteFavorite)
```

æ­¥éª¤6.6: æ›´æ–°å‰ç«¯collectMessage
æ–‡ä»¶: apps/android/app/src/main/java/com/lanxin/im/ui/chat/ChatActivity.kt
ä»£ç : è°ƒç”¨çœŸå®API

ã€P2-2ã€‘å®ç°ä¸¾æŠ¥æ¶ˆæ¯åŠŸèƒ½ (2å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤7.1-7.6: ç±»ä¼¼æ”¶è—åŠŸèƒ½çš„å®Œæ•´å®ç°
- åˆ›å»ºreportsè¡¨è¿ç§»
- åˆ›å»ºReportæ¨¡å‹
- åˆ›å»ºReportDAO
- åˆ›å»ºAPI Handler
- æ³¨å†Œè·¯ç”±
- æ›´æ–°å‰ç«¯è°ƒç”¨

ã€P2-3ã€‘å®ç°æ¶ˆæ¯æœç´¢åŠŸèƒ½ (3å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤8.1: æ·»åŠ DAOå±‚å…¨æ–‡æœç´¢
æ­¥éª¤8.2: åˆ›å»ºSearchService
æ­¥éª¤8.3: åˆ›å»ºAPI Handler
æ­¥éª¤8.4: æ³¨å†Œè·¯ç”±
æ­¥éª¤8.5: å‰ç«¯å®ç°æœç´¢é¡µé¢

ã€P2-4ã€‘å®ç°åˆ†é¡µä¼˜åŒ– (2å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ä¿®æ”¹æ‰€æœ‰DAOæ–¹æ³•æ”¯æŒçœŸå®åˆ†é¡µ
- ContactDAO.GetUserContacts
- MessageDAO.GetMessages
- ç­‰ç­‰

ã€P2-5ã€‘æ·»åŠ å›¾ç‰‡å‹ç¼© (2å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ­¥éª¤9.1: å®ç°å›¾ç‰‡å‹ç¼©
æ–‡ä»¶: apps/android/app/src/main/java/com/lanxin/im/ui/chat/ChatActivity.kt
ä»£ç :
```kotlin
private fun handleImageSelected(uri: Uri) {
    lifecycleScope.launch {
        try {
            // æ˜¾ç¤ºå‹ç¼©ä¸­æç¤º
            Toast.makeText(this@ChatActivity, "æ­£åœ¨å‹ç¼©å›¾ç‰‡...", Toast.LENGTH_SHORT).show()
            
            // åœ¨IOçº¿ç¨‹å‹ç¼©
            val compressedFile = withContext(Dispatchers.IO) {
                compressImage(uri)
            }
            
            // ä¸Šä¼ å‹ç¼©åçš„æ–‡ä»¶
            uploadImage(Uri.fromFile(compressedFile))
        } catch (e: Exception) {
            Toast.makeText(this@ChatActivity, "å‹ç¼©å¤±è´¥: ${e.message}", Toast.LENGTH_SHORT).show()
        }
    }
}

private fun compressImage(uri: Uri): File {
    val inputStream = contentResolver.openInputStream(uri)
    val bitmap = BitmapFactory.decodeStream(inputStream)
    inputStream?.close()
    
    // è®¡ç®—å‹ç¼©æ¯”ä¾‹
    val maxWidth = 1920f
    val maxHeight = 1920f
    val scale = minOf(
        maxWidth / bitmap.width,
        maxHeight / bitmap.height,
        1f
    )
    
    val scaledBitmap = if (scale < 1f) {
        Bitmap.createScaledBitmap(
            bitmap,
            (bitmap.width * scale).toInt(),
            (bitmap.height * scale).toInt(),
            true
        )
    } else {
        bitmap
    }
    
    // å‹ç¼©ä¸ºJPEG
    val file = File(cacheDir, "compressed_${System.currentTimeMillis()}.jpg")
    FileOutputStream(file).use { out ->
        scaledBitmap.compress(Bitmap.CompressFormat.JPEG, 80, out)
    }
    
    bitmap.recycle()
    if (scaledBitmap != bitmap) {
        scaledBitmap.recycle()
    }
    
    return file
}
```

æ·»åŠ import:
```kotlin
import android.graphics.Bitmap
import android.graphics.BitmapFactory
import java.io.FileOutputStream
```

ã€P2-6ã€‘å®ç°è§†é¢‘å‹ç¼© (2å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ä½¿ç”¨VideoCompressor.ktå®ç°è§†é¢‘å‹ç¼©

ã€P2é˜¶æ®µæµ‹è¯•ã€‘(3å°æ—¶)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

å…¨é¢æµ‹è¯•P2åŠŸèƒ½

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ é˜¶æ®µ4ï¼šP3çº§ä¼˜åŒ–ï¼ˆDay 5 - 8å°æ—¶ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€P3-1ã€‘æ·»åŠ Redisç¼“å­˜ (3å°æ—¶)
ã€P3-2ã€‘æ·»åŠ æ–‡ä»¶éªŒè¯ (2å°æ—¶)
ã€P3-3ã€‘ä¼˜åŒ–æ€§èƒ½ (3å°æ—¶)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ å®æ–½æ¸…å•ï¼ˆä¸¥æ ¼æŒ‰åºæ‰§è¡Œï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Day 1 - P0ç¼ºé™·ä¿®å¤:
1. [ ] åˆ›å»ºmessage_dao.go::GetHistoryMessagesæ–¹æ³•
2. [ ] åˆ›å»ºmessage_service.go::GetHistoryMessagesæ–¹æ³•
3. [ ] åˆ›å»ºmessage.go::GetHistoryMessages handler
4. [ ] åœ¨main.goæ³¨å†Œå†å²æ¶ˆæ¯è·¯ç”±
5. [ ] æµ‹è¯•å†å²æ¶ˆæ¯API
6. [ ] ä¿®æ”¹conversation_dao.goæ·»åŠ Preload
7. [ ] æ·»åŠ conversation_dao.go::GetUnreadCountæ–¹æ³•
8. [ ] ä¿®æ”¹conversation.goè¿”å›å®Œæ•´æ•°æ®
9. [ ] æµ‹è¯•ä¼šè¯åˆ—è¡¨API
10. [ ] Androidç«¯åˆ°ç«¯æµ‹è¯•
11. [ ] æ€§èƒ½æµ‹è¯•ï¼ˆ1000æ¡æ¶ˆæ¯ï¼‰
12. [ ] P0é˜¶æ®µéªŒæ”¶

Day 2 - P1ç¼ºé™·ä¿®å¤:
13. [ ] åˆ›å»ºcontact_dao.go::Deleteæ–¹æ³•
14. [ ] åˆ›å»ºcontact_dao.go::UpdateRemarkæ–¹æ³•
15. [ ] åˆ›å»ºcontact_dao.go::GetByIDæ–¹æ³•
16. [ ] åˆ›å»ºcontact_dao.go::CheckExistsæ–¹æ³•
17. [ ] åˆ›å»ºcontact.go::AddContact handler
18. [ ] åˆ›å»ºcontact.go::DeleteContact handler
19. [ ] åˆ›å»ºcontact.go::UpdateRemark handler
20. [ ] åœ¨main.goæ³¨å†Œ3ä¸ªè”ç³»äººè·¯ç”±
21. [ ] æ·»åŠ user_dao.go::UpdatePasswordæ–¹æ³•
22. [ ] æ·»åŠ user_dao.go::GetByIDæ–¹æ³•
23. [ ] åˆ›å»ºuser.go::ChangePassword handler
24. [ ] åœ¨main.goæ³¨å†Œå¯†ç ä¿®æ”¹è·¯ç”±
25. [ ] å‰ç«¯æ·»åŠ ApiService.updateContactRemark
26. [ ] æ›´æ–°RemarkActivityè°ƒç”¨çœŸå®API
27. [ ] åˆ›å»ºWebSocketMessage.kt
28. [ ] æ›´æ–°WebSocketClient.ktæ¶ˆæ¯å¤„ç†
29. [ ] ChatActivityæ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨
30. [ ] ChatListFragmentæ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨
31. [ ] æµ‹è¯•æ‰€æœ‰P1åŠŸèƒ½
32. [ ] P1é˜¶æ®µéªŒæ”¶

Day 3-4 - P2åŠŸèƒ½è¡¥å……:
33. [ ] åˆ›å»ºfavoritesè¡¨è¿ç§»
34. [ ] åˆ›å»ºFavoriteæ¨¡å‹
35. [ ] åˆ›å»ºFavoriteDAO
36. [ ] åˆ›å»ºFavoriteHandler
37. [ ] æ³¨å†Œæ”¶è—è·¯ç”±
38. [ ] æ›´æ–°å‰ç«¯collectMessage
39. [ ] åˆ›å»ºreportsè¡¨è¿ç§»
40. [ ] åˆ›å»ºReportæ¨¡å‹
41. [ ] åˆ›å»ºReportDAO
42. [ ] åˆ›å»ºReportHandler
43. [ ] æ³¨å†Œä¸¾æŠ¥è·¯ç”±
44. [ ] æ›´æ–°å‰ç«¯reportMessage
45. [ ] å®ç°æ¶ˆæ¯æœç´¢DAO
46. [ ] å®ç°æ¶ˆæ¯æœç´¢Service
47. [ ] å®ç°æ¶ˆæ¯æœç´¢Handler
48. [ ] æ³¨å†Œæœç´¢è·¯ç”±
49. [ ] å®ç°çœŸå®åˆ†é¡µï¼ˆæ‰€æœ‰DAOï¼‰
50. [ ] æ·»åŠ å›¾ç‰‡å‹ç¼©ï¼ˆå‰ç«¯ï¼‰
51. [ ] æ·»åŠ è§†é¢‘å‹ç¼©ï¼ˆå‰ç«¯ï¼‰
52. [ ] P2é˜¶æ®µæµ‹è¯•
53. [ ] P2é˜¶æ®µéªŒæ”¶

Day 5 - P3ä¼˜åŒ–:
54. [ ] æ·»åŠ Redisç¼“å­˜
55. [ ] æ·»åŠ æ–‡ä»¶éªŒè¯
56. [ ] æ€§èƒ½ä¼˜åŒ–
57. [ ] å…¨é¢æµ‹è¯•
58. [ ] æœ€ç»ˆéªŒæ”¶

æ€»è®¡: 58ä¸ªæ­¥éª¤

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ ä¸¥æ ¼æ‰§è¡Œè§„åˆ™
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. å¿…é¡»æŒ‰æ¸…å•é¡ºåºæ‰§è¡Œï¼Œä¸å¾—è·³è¿‡
2. æ¯ä¸ªæ­¥éª¤å®Œæˆåå¿…é¡»æµ‹è¯•
3. æµ‹è¯•å¤±è´¥å¿…é¡»ä¿®å¤åæ‰èƒ½ç»§ç»­
4. æ¯å¤©ç»“æŸå‰å¿…é¡»éªŒæ”¶
5. å‘ç°æ–°é—®é¢˜ç«‹å³è®°å½•å¹¶ä¿®å¤
6. ä»£ç å¿…é¡»æœ‰æ³¨é‡Š
7. æäº¤ä¿¡æ¯å¿…é¡»æ¸…æ™°
8. ä¸å…è®¸åç¦»è®¡åˆ’

éªŒæ”¶æ ‡å‡†:
- æ‰€æœ‰APIå¯è°ƒç”¨
- æ‰€æœ‰åŠŸèƒ½å¯ä½¿ç”¨
- æ‰€æœ‰æµ‹è¯•é€šè¿‡
- 0 ç¼–è¯‘é”™è¯¯
- 0 è¿è¡Œæ—¶é”™è¯¯
- é›†æˆåº¦100%

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

