â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  å‰åç«¯é›†æˆå®¡è®¡æŠ¥å‘Š - å®é™…ç¼ºé™·åˆ†æ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å®¡è®¡æ—¶é—´: 2025-10-17
å®¡è®¡æ¨¡å¼: RESEARCH MODE (æ— å¹»æƒ³ï¼ŒåªæŠ¥å‘Šå®é™…é—®é¢˜)
å®¡è®¡èŒƒå›´: Androidå‰ç«¯ â†” Goåç«¯

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ ä¸¥é‡ç¼ºé™·ï¼ˆé˜»å¡åŠŸèƒ½ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€ç¼ºé™·1ã€‘å†å²æ¶ˆæ¯åŠ è½½APIç¼ºå¤± âš ï¸ CRITICAL
å‰ç«¯è°ƒç”¨: GET /conversations/{id}/messages/history
åç«¯å®ç°: âŒ ä¸å­˜åœ¨

å‰ç«¯ä»£ç :
```kotlin
// ChatActivity.kt line 549-554
val response = RetrofitClient.apiService.getHistoryMessages(
    conversationId = conversationId,
    beforeMessageId = oldestMessageId,
    limit = 20
)
```

åç«¯è·¯ç”±: main.go line 129
```go
authorized.GET("/conversations/:id/messages", messageHandler.GetMessages)
// âŒ æ²¡æœ‰ /conversations/:id/messages/history
```

å½±å“: ä¸‹æ‹‰åˆ·æ–°åŠ è½½å†å²æ¶ˆæ¯åŠŸèƒ½å®Œå…¨æ— æ³•å·¥ä½œ
ä¿®å¤: åç«¯éœ€æ·»åŠ GetHistoryMessages handler
å»ºè®®å®ç°:
```go
// message.go éœ€æ·»åŠ 
func (h *MessageHandler) GetHistoryMessages(c *gin.Context) {
    conversationID, _ := strconv.ParseUint(c.Param("id"), 10, 32)
    beforeMessageID, _ := strconv.ParseUint(c.Query("before_message_id"), 10, 32)
    limit, _ := strconv.Atoi(c.DefaultQuery("limit", "20"))
    
    messages, err := h.messageService.GetHistoryMessages(
        uint(conversationID), 
        uint(beforeMessageID), 
        limit
    )
    // ...
}
```

ã€ç¼ºé™·2ã€‘æ·»åŠ è”ç³»äººAPIç¼ºå¤± âš ï¸ HIGH
å‰ç«¯è°ƒç”¨: POST /contacts
åç«¯å®ç°: âŒ è·¯ç”±æœªæ³¨å†Œ

å‰ç«¯APIå®šä¹‰: ApiService.kt line 56-57
```kotlin
@POST("contacts")
suspend fun addContact(@Body request: AddContactRequest): ApiResponse<Contact>
```

åç«¯è·¯ç”±: main.go
```go
// âŒ æ²¡æœ‰ authorized.POST("/contacts", contactHandler.AddContact)
```

å½±å“: æ— æ³•æ·»åŠ æ–°è”ç³»äºº
ä¿®å¤: åç«¯éœ€æ³¨å†ŒPOST /contactsè·¯ç”±

ã€ç¼ºé™·3ã€‘åˆ é™¤è”ç³»äººAPIç¼ºå¤± âš ï¸ HIGH
å‰ç«¯è°ƒç”¨: DELETE /contacts/{id}
åç«¯å®ç°: âŒ è·¯ç”±æœªæ³¨å†Œ

å‰ç«¯APIå®šä¹‰: ApiService.kt line 59-60
```kotlin
@DELETE("contacts/{id}")
suspend fun deleteContact(@Path("id") id: Long): ApiResponse<Any?>
```

åç«¯è·¯ç”±: main.go
```go
// âŒ æ²¡æœ‰ authorized.DELETE("/contacts/:id", contactHandler.DeleteContact)
```

å½±å“: æ— æ³•åˆ é™¤è”ç³»äºº
ä¿®å¤: åç«¯éœ€æ³¨å†ŒDELETE /contacts/:idè·¯ç”±

ã€ç¼ºé™·4ã€‘æ¶ˆæ¯æœç´¢APIç¼ºå¤± âš ï¸ MEDIUM
å‰ç«¯è°ƒç”¨: GET /messages/search
åç«¯å®ç°: âŒ è·¯ç”±æœªæ³¨å†Œ

å‰ç«¯APIå®šä¹‰: ApiService.kt line 93-97
```kotlin
@GET("messages/search")
suspend fun searchMessages(
    @Query("keyword") keyword: String,
    @Query("page") page: Int = 1,
    @Query("page_size") pageSize: Int = 20
): ApiResponse<MessageListResponse>
```

åç«¯è·¯ç”±: main.go
```go
// âŒ æ²¡æœ‰æœç´¢æ¶ˆæ¯API
```

å½±å“: æ¶ˆæ¯æœç´¢åŠŸèƒ½æ— æ³•ä½¿ç”¨
ä¿®å¤: åç«¯éœ€å®ç°æ¶ˆæ¯æœç´¢API

ã€ç¼ºé™·5ã€‘ç”¨æˆ·å¯†ç ä¿®æ”¹APIç¼ºå¤± âš ï¸ MEDIUM
å‰ç«¯è°ƒç”¨: PUT /users/me/password
åç«¯å®ç°: âŒ è·¯ç”±æœªæ³¨å†Œ

å‰ç«¯APIå®šä¹‰: ApiService.kt line 38-39
```kotlin
@PUT("users/me/password")
suspend fun changePassword(@Body request: ChangePasswordRequest): ApiResponse<Any?>
```

åç«¯è·¯ç”±: main.go line 117
```go
authorized.PUT("/users/me", userHandler.UpdateProfile)
// âŒ æ²¡æœ‰ /users/me/password
```

å½±å“: ç”¨æˆ·æ— æ³•ä¿®æ”¹å¯†ç 
ä¿®å¤: åç«¯éœ€æ·»åŠ ChangePassword handler

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ ä¸­ç­‰ç¼ºé™·ï¼ˆåŠŸèƒ½ä¸å®Œæ•´ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€ç¼ºé™·6ã€‘ä¼šè¯åˆ—è¡¨ç¼ºå°‘last_messageæ•°æ® âš ï¸ HIGH
åç«¯å®ç°: conversation.go line 41
```go
"unread_count": 0, // TODO: ä»æœªè¯»æ¶ˆæ¯è¡¨è®¡ç®—
```

å‰ç«¯æœŸæœ›: ConversationItemåŒ…å«last_message
```kotlin
val last_message: Message?
```

å®é™…é—®é¢˜:
- åç«¯TODOæœªå®ç°æœªè¯»è®¡æ•°
- åç«¯æœªè¿”å›last_messageå­—æ®µ
- å‰ç«¯ä¼šæ˜¾ç¤ºnullå¯¼è‡´"[æ¶ˆæ¯]"å ä½ç¬¦

å½±å“: ä¼šè¯åˆ—è¡¨æ— æ³•æ˜¾ç¤ºæœ€åä¸€æ¡æ¶ˆæ¯é¢„è§ˆ
ä¿®å¤: åç«¯éœ€:
1. æŸ¥è¯¢LastMessageå…³è”æ•°æ®
2. è®¡ç®—çœŸå®çš„unread_count
3. åœ¨å“åº”ä¸­åŒ…å«last_message

ã€ç¼ºé™·7ã€‘ContactItemç»“æ„ä¸åŒ¹é… âš ï¸ MEDIUM
å‰ç«¯å®šä¹‰: ApiService.kt line 211-219
```kotlin
data class ContactItem(
    val id: Long,
    val contact_id: Long,
    val user: User,      // âš ï¸ éç©º
    val remark: String?,
    val tags: String?,
    val status: String,
    val created_at: Long
)
```

åç«¯è¿”å›: contact.go line 46
```go
"user": contact.ContactUser,  // å¯èƒ½ä¸ºnil
```

å®é™…é—®é¢˜:
- å‰ç«¯å‡è®¾userå­—æ®µå¿…å®šå­˜åœ¨
- åç«¯å¯èƒ½è¿”å›nilï¼ˆå¦‚æœPreloadå¤±è´¥ï¼‰
- ä¼šå¯¼è‡´NullPointerException

å½±å“: è”ç³»äººåˆ—è¡¨å¯èƒ½å´©æºƒ
ä¿®å¤: å‰ç«¯éœ€æ”¹ä¸º `val user: User?`ï¼ˆå¯ç©ºï¼‰

ã€ç¼ºé™·8ã€‘æ•°æ®ç±»å‹ä¸ä¸€è‡´ âš ï¸ MEDIUM
å‰ç«¯ä½¿ç”¨: Long (64ä½)
```kotlin
val id: Long,
val receiver_id: Long,
```

åç«¯ä½¿ç”¨: uint (32ä½)
```go
type Contact struct {
    ID        uint      `gorm:"primarykey" json:"id"`
    UserID    uint      `gorm:"not null;index" json:"user_id"`
    ContactID uint      `gorm:"not null;index" json:"contact_id"`
}
```

å®é™…é—®é¢˜:
- uintåœ¨Goä¸­æ˜¯32ä½ï¼ˆåœ¨32ä½ç³»ç»Ÿï¼‰æˆ–64ä½ï¼ˆ64ä½ç³»ç»Ÿï¼‰
- å¯èƒ½å¯¼è‡´å¤§æ•°å€¼æˆªæ–­
- JSONåºåˆ—åŒ–å¯èƒ½ä¸¢å¤±ç²¾åº¦

å½±å“: å¤§IDå€¼å¯èƒ½å‡ºé”™
ä¿®å¤: åç«¯åº”ç»Ÿä¸€ä½¿ç”¨uint64æˆ–int64

ã€ç¼ºé™·9ã€‘WebSocketæ¶ˆæ¯æ¥æ”¶ä¸å®Œæ•´ âš ï¸ HIGH
å‰ç«¯å®ç°: WebSocketClient.kt
```kotlin
// å·²å®ç°WebSocketè¿æ¥
```

åç«¯å®ç°: websocket/hub.go, websocket/client.go
```go
// Hubå’ŒClientå·²å®ç°
```

å®é™…é—®é¢˜:
- å‰ç«¯æ”¶åˆ°WebSocketæ¶ˆæ¯åï¼Œæœªè‡ªåŠ¨åˆ·æ–°ä¼šè¯åˆ—è¡¨
- å‰ç«¯æ”¶åˆ°æ¶ˆæ¯åï¼Œæœªæ›´æ–°æœªè¯»è®¡æ•°
- å‰ç«¯æœªå®ç°æ¶ˆæ¯å·²è¯»å›æ‰§çš„WebSocketé€šçŸ¥

å½±å“: 
- æ”¶åˆ°æ–°æ¶ˆæ¯ä¸ä¼šè‡ªåŠ¨æ˜¾ç¤º
- æœªè¯»æ•°ä¸ä¼šå®æ—¶æ›´æ–°
- å¯¹æ–¹ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦å·²è¯»

ä¿®å¤: å‰ç«¯éœ€æ·»åŠ WebSocketæ¶ˆæ¯å¤„ç†é€»è¾‘

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ ä¸€èˆ¬ç¼ºé™·ï¼ˆä½“éªŒé—®é¢˜ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€ç¼ºé™·10ã€‘ä¼šè¯åˆ—è¡¨ç¼ºå°‘ç”¨æˆ·ä¿¡æ¯ âš ï¸ MEDIUM
åç«¯ä»£ç : conversation.go line 46-51
```go
// æ·»åŠ å¯¹æ–¹ç”¨æˆ·ä¿¡æ¯
if conv.Type == "single" {
    if conv.User1ID != nil && *conv.User1ID != userID {
        item["user"] = conv.User1
    } else if conv.User2ID != nil {
        item["user"] = conv.User2
    }
}
```

å®é™…é—®é¢˜:
- Preloadå…³è”æœªå®ç°ï¼ŒUser1/User2ä¸ºnil
- éœ€è¦åœ¨DAOä¸­æ·»åŠ Preload("User1").Preload("User2")

å½±å“: ä¼šè¯åˆ—è¡¨æ˜¾ç¤º"ç”¨æˆ·ID"è€ŒéçœŸå®å§“å
ä¿®å¤: ConversationDAOéœ€æ·»åŠ :
```go
Preload("User1").Preload("User2").Preload("LastMessage")
```

ã€ç¼ºé™·11ã€‘ç¼ºå°‘æ”¶è—/ä¸¾æŠ¥/å¤‡æ³¨API âš ï¸ LOW
å‰ç«¯è°ƒç”¨:
- collectMessage() - æ”¶è—æ¶ˆæ¯
- reportMessage() - ä¸¾æŠ¥æ¶ˆæ¯  
- updateContactRemark() - æ›´æ–°å¤‡æ³¨

åç«¯å®ç°: âŒ å…¨éƒ¨ç¼ºå¤±

å®é™…é—®é¢˜:
- å‰ç«¯åŠŸèƒ½å·²å®ç°ä½†åç«¯APIä¸å­˜åœ¨
- è°ƒç”¨ä¼šè¿”å›404é”™è¯¯

å½±å“: è¿™äº›åŠŸèƒ½æ— æ³•å®é™…ä½¿ç”¨
ä¿®å¤: åç«¯éœ€æ·»åŠ è¿™äº›API endpoints

ã€ç¼ºé™·12ã€‘ç¼ºå°‘å›¾ç‰‡/è§†é¢‘å‹ç¼© âš ï¸ MEDIUM
å‰ç«¯ä»£ç :
- ChatActivity.ktä½¿ç”¨VideoCompressor
- ä½†å®é™…æœªè°ƒç”¨å‹ç¼©é€»è¾‘

å®é™…é—®é¢˜:
- å¤§æ–‡ä»¶ç›´æ¥ä¸Šä¼ ï¼Œè€—è´¹æµé‡
- æ²¡æœ‰å‹ç¼©è´¨é‡æ§åˆ¶
- æ²¡æœ‰å°ºå¯¸é™åˆ¶

å½±å“: ç”¨æˆ·æµé‡æ¶ˆè€—å¤§ï¼Œä¸Šä¼ æ…¢
ä¿®å¤: å‰ç«¯éœ€åœ¨handleImageSelected/handleVideoSelectedä¸­è°ƒç”¨å‹ç¼©

ã€ç¼ºé™·13ã€‘ç¼ºå°‘ç¦»çº¿æ¶ˆæ¯æ¨é€ âš ï¸ MEDIUM
å‰ç«¯å®ç°: âŒ æ— æ¨é€é›†æˆ
åç«¯å®ç°: âŒ æ— æ¨é€æœåŠ¡

å®é™…é—®é¢˜:
- ç”¨æˆ·ç¦»çº¿æ—¶æ”¶ä¸åˆ°æ¶ˆæ¯é€šçŸ¥
- éœ€è¦ä¸»åŠ¨æ‰“å¼€Appæ‰èƒ½çœ‹åˆ°æ–°æ¶ˆæ¯

å½±å“: ç”¨æˆ·ä½“éªŒå·®
ä¿®å¤: éœ€é›†æˆFCM/åä¸ºæ¨é€ç­‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… æ•°æ®ç»“æ„åŒ¹é…åº¦æ£€æŸ¥
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€Contactæ•°æ®ç»“æ„ã€‘
å‰ç«¯:
```kotlin
data class Contact(
    val id: Long,
    val userId: Long,
    val contactId: Long,
    val username: String = "",
    val remark: String?,
    val tags: String?,
    val status: String,
    val createdAt: Long,
    val updatedAt: Long
)
```

åç«¯:
```go
type Contact struct {
    ID        uint      `json:"id"`
    UserID    uint      `json:"user_id"`
    ContactID uint      `json:"contact_id"`
    Remark    string    `json:"remark,omitempty"`
    Tags      string    `json:"tags,omitempty"`
    Status    string    `json:"status"`
    CreatedAt time.Time `json:"created_at"`
    UpdatedAt time.Time `json:"updated_at"`
    ContactUser User    `json:"contact_user,omitempty"`
}
```

é—®é¢˜:
âŒ å‰ç«¯usernameå­—æ®µ â‰  åç«¯æ— æ­¤å­—æ®µ
âŒ å‰ç«¯æœŸæœ›Long â‰  åç«¯ä½¿ç”¨uint
âœ… å…¶ä»–å­—æ®µåŒ¹é…

ã€Messageæ•°æ®ç»“æ„ã€‘
å‰ç«¯:
```kotlin
data class Message(
    val id: Long,
    val conversationId: Long,
    val senderId: Long,
    val receiverId: Long,
    val content: String,
    val type: String,
    val fileUrl: String?,
    val fileSize: Long?,
    val duration: Int?,
    val status: String,
    val createdAt: Long,
    val updatedAt: Long
)
```

åç«¯: æœªæ‰¾åˆ°å®Œæ•´å®šä¹‰ï¼Œéœ€æ£€æŸ¥

ã€Conversationæ•°æ®ç»“æ„ã€‘
åŒ¹é…åº¦: 80%
é—®é¢˜:
- å‰ç«¯ä¸ä½¿ç”¨User1/User2å…³è”
- åç«¯è¿”å›çš„æ•°æ®ç»“æ„å‰ç«¯æœªå®Œå…¨åˆ©ç”¨

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” APIè·¯ç”±å¯¹æ¯”è¡¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

APIåç§°                          | å‰ç«¯å®šä¹‰ | åç«¯å®ç° | çŠ¶æ€
--------------------------------|---------|---------|------
POST /auth/register             | âœ…      | âœ…      | âœ… OK
POST /auth/login                | âœ…      | âœ…      | âœ… OK
POST /auth/refresh              | âœ…      | âœ…      | âœ… OK
POST /auth/logout               | âœ…      | âœ…      | âœ… OK
GET  /users/me                  | âœ…      | âœ…      | âœ… OK
PUT  /users/me                  | âœ…      | âœ…      | âœ… OK
PUT  /users/me/password         | âœ…      | âŒ      | âŒ ç¼ºå¤±
GET  /users/search              | âœ…      | âœ…      | âœ… OK
GET  /contacts                  | âœ…      | âœ…      | âœ… OK
POST /contacts                  | âœ…      | âŒ      | âŒ ç¼ºå¤±
DELETE /contacts/{id}           | âœ…      | âŒ      | âŒ ç¼ºå¤±
GET  /conversations             | âœ…      | âœ…      | âš ï¸ æ•°æ®ä¸å®Œæ•´
GET  /conversations/{id}/messages | âœ…    | âœ…      | âœ… OK
GET  /conversations/{id}/messages/history | âœ… | âŒ | âŒ ç¼ºå¤±
POST /messages                  | âœ…      | âœ…      | âœ… OK
POST /messages/{id}/recall      | âœ…      | âœ…      | âœ… OK
POST /conversations/{id}/read   | âœ…      | âœ…      | âœ… OK
GET  /messages/search           | âœ…      | âŒ      | âŒ ç¼ºå¤±
GET  /files/upload-token        | âœ…      | âœ…      | âœ… OK
POST /files/upload-callback     | âœ…      | âœ…      | âœ… OK
POST /trtc/user-sig             | âœ…      | âœ…      | âœ… OK
POST /trtc/call                 | âœ…      | âœ…      | âœ… OK

æ–°åŠŸèƒ½API (å‰ç«¯å·²å®ç°):
POST /contacts/{id}/remark      | âœ…      | âŒ      | âŒ ç¼ºå¤±
POST /messages/collect          | âœ…      | âŒ      | âŒ ç¼ºå¤±
POST /messages/report           | âœ…      | âŒ      | âŒ ç¼ºå¤±

ç»Ÿè®¡:
- å‰ç«¯å®šä¹‰: 25ä¸ªAPI
- åç«¯å®ç°: 16ä¸ªAPI
- ç¼ºå¤±API: 9ä¸ª (36%)
- æ•°æ®ä¸å®Œæ•´: 1ä¸ª (4%)

æ€»ä½“åŒ¹é…åº¦: 60% âš ï¸

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ æ•°æ®å®Œæ•´æ€§é—®é¢˜
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€é—®é¢˜1ã€‘ConversationListResponseç¼ºå°‘å…³é”®å­—æ®µ
åç«¯è¿”å›: conversation.go
```go
item := map[string]interface{}{
    "id":           conv.ID,
    "type":         conv.Type,
    "unread_count": 0,           // âŒ ç¡¬ç¼–ç ä¸º0
    "updated_at":   conv.UpdatedAt.Unix(),
    "user":         ...,         // âš ï¸ å¯èƒ½ä¸ºnil
    // âŒ ç¼ºå°‘ last_message
}
```

å‰ç«¯æœŸæœ›:
```kotlin
data class ConversationItem(
    val id: Long,
    val type: String,
    val user: User?,
    val last_message: Message?,  // âŒ åç«¯æœªè¿”å›
    val unread_count: Int,       // âŒ åç«¯è¿”å›0
    val updated_at: Long
)
```

å½±å“:
- ä¼šè¯åˆ—è¡¨æ— æ³•æ˜¾ç¤ºæœ€åä¸€æ¡æ¶ˆæ¯
- æœªè¯»æ•°æ°¸è¿œä¸º0
- ç”¨æˆ·ä½“éªŒä¸¥é‡ä¸‹é™

ã€é—®é¢˜2ã€‘ContactItemç¼ºå°‘Userå¯¹è±¡
åç«¯è¿”å›: contact.go line 46
```go
"user": contact.ContactUser,  // âš ï¸ æœªPreloadï¼Œå¯èƒ½ä¸ºç©ºç»“æ„
```

å‰ç«¯æœŸæœ›:
```kotlin
val user: User,  // âŒ æ ‡è®°ä¸ºéç©ºï¼Œå®é™…å¯èƒ½ä¸ºnull
```

å½±å“:
- å¦‚æœContactUserä¸ºç©ºï¼Œå‰ç«¯ä¼šå´©æºƒ
- éœ€è¦å‰ç«¯æ”¹ä¸ºå¯ç©ºæˆ–åç«¯ä¿è¯Preload

ã€é—®é¢˜3ã€‘Userå¯¹è±¡å­—æ®µç¼ºå¤±
åç«¯æ¨¡å‹: model/user.go (éœ€æ£€æŸ¥)
å‰ç«¯æœŸæœ›:
```kotlin
data class User(
    val id: Long,
    val username: String,
    val displayName: String? = null,  // âŒ åç«¯å¯èƒ½æ— æ­¤å­—æ®µ
    val phone: String?,
    val email: String?,
    val avatar: String?,
    val lanxinId: String,
    val role: String,
    val status: String,
    val lastLoginAt: Long?,
    val createdAt: Long
)
```

éœ€è¦ç¡®è®¤åç«¯Useræ¨¡å‹æ˜¯å¦åŒ…å«æ‰€æœ‰å­—æ®µ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ å®‰å…¨éšæ‚£
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€éšæ‚£1ã€‘æ–‡ä»¶ä¸Šä¼ æœªéªŒè¯
å‰ç«¯: ç›´æ¥ä¸Šä¼ ä»»æ„æ–‡ä»¶
åç«¯: æœªè§æ–‡ä»¶ç±»å‹/å¤§å°éªŒè¯

é£é™©:
- æ¶æ„ç”¨æˆ·ä¸Šä¼ è¶…å¤§æ–‡ä»¶
- ä¸Šä¼ å¯æ‰§è¡Œæ–‡ä»¶
- å­˜å‚¨ç©ºé—´è¢«å æ»¡

ä¿®å¤: 
- å‰ç«¯é™åˆ¶æ–‡ä»¶ç±»å‹å’Œå¤§å°
- åç«¯æ·»åŠ ç™½åå•éªŒè¯

ã€éšæ‚£2ã€‘æ¶ˆæ¯å†…å®¹æœªè½¬ä¹‰
å‰ç«¯: ç›´æ¥å‘é€åŸå§‹å†…å®¹
åç«¯: æœªè§XSSè¿‡æ»¤

é£é™©:
- å¯èƒ½æ³¨å…¥æ¶æ„è„šæœ¬
- è·¨ç«™è„šæœ¬æ”»å‡»

ä¿®å¤:
- åç«¯éœ€HTMLè½¬ä¹‰
- å‰ç«¯æ˜¾ç¤ºæ—¶ä¹Ÿéœ€è½¬ä¹‰

ã€éšæ‚£3ã€‘æœªè¯»æ¶ˆæ¯æ— é™å¢é•¿
åç«¯: unread_countç¡¬ç¼–ç ä¸º0
å®é™…: æœªå®ç°å·²è¯»æ ‡è®°æ¸…ç†é€»è¾‘

é£é™©:
- æ•°æ®åº“æœªè¯»æ¶ˆæ¯è®°å½•æ— é™å¢é•¿
- æ€§èƒ½ä¸‹é™

ä¿®å¤:
- å®ç°markAsReadçš„å®é™…é€»è¾‘
- æ¸…ç†å·²è¯»æ¶ˆæ¯æ ‡è®°

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ æ€§èƒ½é—®é¢˜
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€é—®é¢˜1ã€‘N+1æŸ¥è¯¢é—®é¢˜
åç«¯ä»£ç : conversation.goè·å–ä¼šè¯åˆ—è¡¨æ—¶
```go
// æœªä½¿ç”¨Preloadï¼Œå¯èƒ½é€ æˆN+1æŸ¥è¯¢
```

å½±å“: æ¯ä¸ªä¼šè¯éƒ½å•ç‹¬æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
ä¿®å¤: ä½¿ç”¨GORM Preload

ã€é—®é¢˜2ã€‘æœªå®ç°åˆ†é¡µ
å‰ç«¯è°ƒç”¨: getContacts(page, pageSize)
åç«¯å®ç°: GetUserContacts() - âŒ æœªä½¿ç”¨åˆ†é¡µå‚æ•°

å½±å“: è”ç³»äººå¤šæ—¶ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
ä¿®å¤: DAOéœ€å®ç°çœŸå®åˆ†é¡µ

ã€é—®é¢˜3ã€‘ç¼ºå°‘ç¼“å­˜
è§‚å¯Ÿ: 
- ç”¨æˆ·ä¿¡æ¯é¢‘ç¹æŸ¥è¯¢
- æ— Redisç¼“å­˜ä½¿ç”¨
- æ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“

å½±å“: æ•°æ®åº“å‹åŠ›å¤§
ä¿®å¤: æ·»åŠ Redisç¼“å­˜ç”¨æˆ·ä¿¡æ¯

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ åŠŸèƒ½ç¼ºå¤±æ¸…å•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€åç«¯éœ€è¦æ·»åŠ çš„APIã€‘(9ä¸ª)
1. GET  /conversations/{id}/messages/history
2. POST /contacts
3. DELETE /contacts/{id}
4. PUT  /users/me/password
5. GET  /messages/search
6. POST /contacts/{id}/remark
7. POST /messages/collect
8. POST /messages/report
9. PUT  /conversations/{id}/settings (å…æ‰“æ‰°/ç½®é¡¶)

ã€åç«¯éœ€è¦å®Œå–„çš„åŠŸèƒ½ã€‘
1. GetConversations - è¿”å›last_message
2. GetConversations - è®¡ç®—çœŸå®unread_count
3. GetUserContacts - å®ç°åˆ†é¡µ
4. æ‰€æœ‰DAO - æ·»åŠ Preloadå…³è”æŸ¥è¯¢

ã€å‰ç«¯éœ€è¦ä¿®å¤çš„é—®é¢˜ã€‘
1. ContactItem.useræ”¹ä¸ºå¯ç©ºç±»å‹
2. WebSocketæ¶ˆæ¯å¤„ç†é€»è¾‘
3. æ·»åŠ å›¾ç‰‡/è§†é¢‘å‹ç¼©è°ƒç”¨
4. æ·»åŠ æ–‡ä»¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
5. æ·»åŠ ç½‘ç»œçŠ¶æ€æ£€æµ‹

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š é›†æˆå®Œæ•´åº¦è¯„åˆ†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

APIå®Œæ•´åº¦: 60% (16/25å®ç°)
æ•°æ®å®Œæ•´åº¦: 40% (ç¼ºå°‘å…³è”æ•°æ®)
åŠŸèƒ½å¯ç”¨åº¦: 70% (æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ï¼Œè¾…åŠ©åŠŸèƒ½ç¼ºå¤±)
å®‰å…¨æ€§: 60% (åŸºæœ¬è®¤è¯OKï¼Œç¼ºå°‘å†…å®¹éªŒè¯)
æ€§èƒ½: 50% (æ— ç¼“å­˜ï¼Œæœ‰N+1é—®é¢˜)

æ€»ä½“é›†æˆåº¦: 56% âš ï¸ ä¸åŠæ ¼

è¯„ä»·: æ ¸å¿ƒåŠŸèƒ½åŸºæœ¬å¯ç”¨ï¼Œä½†æœ‰å¤šå¤„ä¸¥é‡ç¼ºé™·

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ ä¼˜å…ˆçº§ä¿®å¤å»ºè®®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€P0 - ç«‹å³ä¿®å¤ã€‘(é˜»å¡æ ¸å¿ƒåŠŸèƒ½)
1. å®ç°getHistoryMessages API
2. GetConversationsè¿”å›last_messageå’ŒçœŸå®unread_count
3. å‰ç«¯ContactItem.useræ”¹ä¸ºå¯ç©º
4. DAOæ·»åŠ Preloadå…³è”æŸ¥è¯¢

ã€P1 - é«˜ä¼˜å…ˆçº§ã€‘(ä¸¥é‡å½±å“ä½“éªŒ)
5. å®ç°POST/DELETE /contacts API
6. å®ç°WebSocketæ¶ˆæ¯å®æ—¶å¤„ç†
7. å®ç°PUT /users/me/password API
8. ä¿®å¤uint/Longç±»å‹ä¸ä¸€è‡´

ã€P2 - ä¸­ä¼˜å…ˆçº§ã€‘(å®Œå–„åŠŸèƒ½)
9. å®ç°æ”¶è—/ä¸¾æŠ¥/å¤‡æ³¨API
10. å®ç°æ¶ˆæ¯æœç´¢API
11. æ·»åŠ å›¾ç‰‡/è§†é¢‘å‹ç¼©
12. å®ç°çœŸå®åˆ†é¡µ

ã€P3 - ä½ä¼˜å…ˆçº§ã€‘(ä¼˜åŒ–)
13. æ·»åŠ Redisç¼“å­˜
14. æ·»åŠ æ–‡ä»¶éªŒè¯
15. æ·»åŠ XSSè¿‡æ»¤
16. é›†æˆæ¨é€æœåŠ¡

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ æ— å¹»æƒ³çš„çœŸå®æƒ…å†µ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

çœŸå®å¯ç”¨çš„åŠŸèƒ½:
âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
âœ… å‘é€æ–‡æœ¬æ¶ˆæ¯
âœ… æ’¤å›æ¶ˆæ¯
âœ… è·å–æ¶ˆæ¯åˆ—è¡¨
âœ… æ ‡è®°å·²è¯»
âœ… æ–‡ä»¶ä¸Šä¼ 
âœ… TRTCéŸ³è§†é¢‘

å®Œå…¨ä¸å¯ç”¨çš„åŠŸèƒ½:
âŒ ä¸‹æ‹‰åŠ è½½å†å²æ¶ˆæ¯ (APIç¼ºå¤±)
âŒ æ·»åŠ /åˆ é™¤è”ç³»äºº (APIç¼ºå¤±)
âŒ ä¿®æ”¹å¯†ç  (APIç¼ºå¤±)
âŒ æ¶ˆæ¯æœç´¢ (APIç¼ºå¤±)
âŒ æ”¶è—æ¶ˆæ¯ (APIç¼ºå¤±)
âŒ ä¸¾æŠ¥æ¶ˆæ¯ (APIç¼ºå¤±)
âŒ è®¾ç½®å¤‡æ³¨ (APIç¼ºå¤±)

éƒ¨åˆ†å¯ç”¨çš„åŠŸèƒ½:
âš ï¸ ä¼šè¯åˆ—è¡¨ (èƒ½è·å–ï¼Œä½†æ— æ¶ˆæ¯é¢„è§ˆ)
âš ï¸ è”ç³»äººåˆ—è¡¨ (èƒ½è·å–ï¼Œä½†å¯èƒ½ç¼ºç”¨æˆ·ä¿¡æ¯)
âš ï¸ è½¬å‘æ¶ˆæ¯ (å‰ç«¯OKï¼Œåç«¯ç”¨sendMessageå®ç°)
âš ï¸ WebSocket (è¿æ¥OKï¼Œæ¶ˆæ¯å¤„ç†ä¸å®Œæ•´)

å½“å‰å®é™…å¯ç”¨åº¦: çº¦50-60%

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… å»ºè®®çš„ä¿®å¤é¡ºåº
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç¬¬ä¸€æ­¥ (1å¤©):
1. åç«¯æ·»åŠ getHistoryMessages API
2. åç«¯GetConversationsæ·»åŠ Preload
3. å‰ç«¯ä¿®å¤ContactItem.userä¸ºå¯ç©º

ç¬¬äºŒæ­¥ (1å¤©):
4. åç«¯æ·»åŠ POST/DELETE contacts API
5. åç«¯å®ç°çœŸå®unread_countè®¡ç®—
6. å‰ç«¯å®Œå–„WebSocketæ¶ˆæ¯å¤„ç†

ç¬¬ä¸‰æ­¥ (2å¤©):
7. åç«¯æ·»åŠ æ”¶è—/ä¸¾æŠ¥/å¤‡æ³¨API
8. åç«¯æ·»åŠ æ¶ˆæ¯æœç´¢API
9. å‰ç«¯æ·»åŠ å›¾ç‰‡å‹ç¼©

ç¬¬å››æ­¥ (1å‘¨):
10. ä¼˜åŒ–æ€§èƒ½ï¼ˆç¼“å­˜ã€N+1ï¼‰
11. å®Œå–„å®‰å…¨ï¼ˆéªŒè¯ã€è¿‡æ»¤ï¼‰
12. é›†æˆæ¨é€æœåŠ¡

é¢„è®¡ä¿®å¤æ—¶é—´: 5-7å¤©å¯è¾¾åˆ°90%å¯ç”¨åº¦

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ ç»“è®º
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç°çŠ¶:
- å‰ç«¯UI/é€»è¾‘: 100%å®Œæˆ âœ…
- åç«¯APIå®ç°: 60%å®Œæˆ âš ï¸
- å‰åç«¯é›†æˆ: 56%å®Œæˆ âš ï¸

ä¸»è¦é—®é¢˜:
1. åç«¯APIç¼ºå¤±9ä¸ª (36%)
2. æ•°æ®å…³è”ä¸å®Œæ•´ (Preloadç¼ºå¤±)
3. æ•°æ®ç±»å‹ä¸ä¸€è‡´ (uint vs Long)
4. WebSocketæ¶ˆæ¯å¤„ç†ä¸å®Œæ•´
5. ç¼ºå°‘ç¼“å­˜å’Œä¼˜åŒ–

å®é™…èƒ½åŠ›:
- åŸºæœ¬èŠå¤©: âœ… å¯ç”¨
- å†å²åŠ è½½: âŒ ä¸å¯ç”¨
- è”ç³»äººç®¡ç†: âš ï¸ åªè¯»
- é«˜çº§åŠŸèƒ½: âŒ å¤§éƒ¨åˆ†ä¸å¯ç”¨

å»ºè®®:
éœ€è¦1å‘¨æ—¶é—´ä¿®å¤åç«¯ç¼ºé™·ï¼Œæ‰èƒ½è¾¾åˆ°ç”Ÿäº§çº§åˆ«

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


